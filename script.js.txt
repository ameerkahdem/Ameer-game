// =============== 1) Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ===============
// Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù…Ù† Firebase Ù‡Ù†Ø§ ğŸ‘‡

const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_APP.firebaseapp.com",
    databaseURL: "https://YOUR_APP.firebaseio.com",
    projectId: "YOUR_APP",
    storageBucket: "YOUR_APP.appspot.com",
    messagingSenderId: "0000000000",
    appId: "1:000:web000"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// =============== 2) Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© ===============
let roomID = "";
let playerName = "";
let isHost = false;
const words = ["Ù…Ø¯Ø±Ø³Ø©","Ù‡Ø§ØªÙ","Ø³ÙŠØ§Ø±Ø©","Ù…Ø³ØªØ´ÙÙ‰","Ø´Ù„Ø§Ù„","Ø¨ØµÙ…Ø©","Ø­Ø§Ø³ÙˆØ¨","Ù…Ø·Ø¹Ù…","Ù…Ø·Ø§Ø±","Ø­Ø¯ÙŠÙ‚Ø©"];

// =============== 3) Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© ===============
function createRoom(){
    roomID = Math.floor(1000 + Math.random() * 9000).toString();
    isHost = true;

    db.ref("rooms/"+roomID).set({
        started:false,
        players:{}
    });

    showRoom();
}

// =============== 4) Ø¯Ø®ÙˆÙ„ ØºØ±ÙØ© ===============
function joinRoom(){
    const code = document.getElementById("joinCode").value;
    if(code.length < 4) return alert("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­");
    roomID = code;
    showRoom();
}

// =============== 5) Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØºØ±ÙØ© ===============
function showRoom(){
    document.getElementById("home").style.display = "none";
    document.getElementById("room").style.display = "block";
    document.getElementById("roomId").innerText = roomID;
}

// =============== 6) ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ ===============
function registerPlayer(){
    playerName = document.getElementById("playerName").value;
    if(!playerName) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ");

    db.ref(`rooms/${roomID}/players/${playerName}`).set({
        isSpy:false,
        word:""
    });

    // Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    db.ref(`rooms/${roomID}/players`).on("value", snap=>{
        const list = Object.keys(snap.val() || {});
        document.getElementById("playerList").innerHTML =
          "<h3>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†:</h3>" + list.join("<br>");

        if(isHost && list.length > 2)
            document.getElementById("startBtn").style.display="block";
    });

    // Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
    db.ref(`rooms/${roomID}/started`).on("value", snap=>{
        if(snap.val() === true) {
            loadGame();
        }
    });
}

// =============== 7) Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø§Ø®ØªÙŠØ§Ø± Ø¬Ø§Ø³ÙˆØ³ + ÙƒÙ„Ù…Ø©) ===============
function startGame(){
    db.ref(`rooms/${roomID}/players`).once("value").then(snap=>{
        const players = Object.keys(snap.val());
        const spy = players[Math.floor(Math.random() * players.length)];
        const word = words[Math.floor(Math.random() * words.length)];

        players.forEach(name=>{
            db.ref(`rooms/${roomID}/players/${name}`).update({
                isSpy: name === spy,
                word: word
            });
        });

        db.ref(`rooms/${roomID}`).update({ started:true });
    });
}

// =============== 8) ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ===============
function loadGame(){
    document.getElementById("room").style.display="none";
    document.getElementById("game").style.display="block";

    db.ref(`rooms/${roomID}/players/${playerName}`).once("value").then(snap=>{
        const data = snap.val();
        if(data.isSpy){
            document.getElementById("yourRole").innerText = "â— Ø£Ù†Øª Ø§Ù„Ø¬Ø§Ø³ÙˆØ³";
            document.getElementById("theWord").innerText = "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø© Ù„Ùƒ";
        } else {
            document.getElementById("yourRole").innerText = "âœ” Ø£Ù†Øª Ù„Ø§Ø¹Ø¨ Ø¹Ø§Ø¯ÙŠ";
            document.getElementById("theWord").innerText = "Ø§Ù„ÙƒÙ„Ù…Ø©: " + data.word;
        }
    });
}