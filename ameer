<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¥Ù…Ø¨ÙˆØ³ØªØ± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; margin-top:50px; }
input, button { font-size: 18px; padding: 8px; margin: 5px; }
#gameArea { display:none; margin-top:20px; }
</style>
</head>
<body>

<h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¥Ù…Ø¨ÙˆØ³ØªØ± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ</h1>

<div id="joinDiv">
  <input id="playerName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
  <button onclick="joinRoom()">Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button>
</div>

<div id="gameArea">
  <h2>ØºØ±ÙØ© Ø±Ù‚Ù…: <span id="roomCode"></span></h2>
  <h3 id="yourWord">ÙƒÙ„Ù…ØªÙƒ: </h3>
  <button onclick="startGame()">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù„Ù…Ù†Ø´Ø¦ Ø§Ù„ØºØ±ÙØ©)</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
<script>
// ğŸ”¹ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "123456",
    appId: "1:123456:web:abc123"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ğŸ”¹ ÙƒÙ„Ù…Ø§Øª Ø¹Ø±Ø¨ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©
const words = ["ØªÙØ§Ø­Ø©","Ù…Ø¯Ø±Ø³Ø©","Ø³ÙŠØ§Ø±Ø©","Ù‡Ø§ØªÙ","Ù†Ø¸Ø§Ø±Ø©","Ø´Ù„Ø§Ù„","Ù‚Ø·Ø§Ø±","Ù…Ø³ØªØ´ÙÙ‰","Ø¨Ø±Ø¬ Ø®Ù„ÙŠÙØ©","Ù…ÙØ§Ø¹Ù„ Ù†ÙˆÙˆÙŠ"];

let roomCode = Math.floor(10000 + Math.random() * 90000).toString();
let playerName = "";

// ğŸ”¹ Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ©
function joinRoom() {
    playerName = document.getElementById("playerName").value.trim();
    if(!playerName){ alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ"); return; }

    db.ref("rooms/" + roomCode).once("value", snap => {
        if(!snap.exists()){
            // Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
            db.ref("rooms/" + roomCode).set({started:false, players:{}});
        }
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
        db.ref("rooms/" + roomCode + "/players/" + playerName).set({isImposter:false});
        document.getElementById("joinDiv").style.display="none";
        document.getElementById("gameArea").style.display="block";
        document.getElementById("roomCode").innerText = roomCode;
        listenForWord();
    });
}

// ğŸ”¹ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ø®ØªÙŠØ§Ø± Ø¬Ø§Ø³ÙˆØ³
function startGame() {
    db.ref("rooms/" + roomCode + "/players").once("value", snap => {
        const players = snap.val();
        const names = Object.keys(players);
        const imposterName = names[Math.floor(Math.random() * names.length)];
        const word = words[Math.floor(Math.random() * words.length)];

        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        names.forEach(name => {
            db.ref("rooms/" + roomCode + "/players/" + name).update({
                isImposter: (name===imposterName)
            });
        });

        db.ref("rooms/" + roomCode + "/word").set(word);
        db.ref("rooms/" + roomCode + "/imposter").set(imposterName);
        db.ref("rooms/" + roomCode + "/started").set(true);
    });
}

// ğŸ”¹ Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø©
function listenForWord() {
    db.ref("rooms/" + roomCode).on("value", snap => {
        const data = snap.val();
        if(!data || !data.started) return;
        const imposter = data.imposter;
        const word = data.word;
        db.ref("rooms/" + roomCode + "/players/" + playerName).once("value", pSnap => {
            const playerData = pSnap.val();
            if(playerData.isImposter){
                document.getElementById("yourWord").innerText = "â— Ø£Ù†Øª Ø§Ù„Ø¬Ø§Ø³ÙˆØ³! Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø©";
            } else {
                document.getElementById("yourWord").innerText = "ÙƒÙ„Ù…ØªÙƒ: " + word;
            }
        });
    });
}
</script>

</body>
</html>
